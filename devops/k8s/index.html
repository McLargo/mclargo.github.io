<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Javier Gil">
    <link rel="canonical" href="https://mclargo.github.io/devops/k8s/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Kubernetes - My technical wiki</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../assets/css/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Kubernetes", url: "#_top", children: [
              {title: "Local k8s cluster", url: "#local-k8s-cluster" },
              {title: "Helm charts", url: "#helm-charts" },
              {title: "Readiness and liveness, startup probes", url: "#readiness-and-liveness-startup-probes" },
              {title: "References", url: "#references" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../serverless/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../serverless/" class="btn btn-xs btn-link">
        Serverless Computing
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../features-toggles/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../features-toggles/" class="btn btn-xs btn-link">
        Features Toggles
      </a>
    </div>
    
  </div>

    

    <h1 id="kubernetes">Kubernetes</h1>
<p>It is a high-disponiblity platform. It support different application available to be consume</p>
<p>Instead of monolithic application, microservices oriented.</p>
<p>1 Pod -&gt; 1 or more docker container -&gt; 1 image -&gt; 1 service</p>
<p>If a pod dies, controller (object) automatically enable another with configuration expected.</p>
<p>Main concept is objects. It can be of several types.</p>
<p>Master-node, it has the control .
Quorum, master-node must be a odd number of instances.
Cluster between master/worker nodes</p>
<p>Service - &gt; deployment -&gt; replicaset -&gt; POD</p>
<p>Service can be:</p>
<ul>
<li>cluster IP (DNS)</li>
<li>load balancer</li>
<li>node ports</li>
</ul>
<p>Ingress, it is like a callback.
Storage or persistent</p>
<p>Other concepts:</p>
<ul>
<li>label</li>
<li>memory</li>
<li>cpu</li>
<li>rback
-namespaces</li>
</ul>
<h2 id="local-k8s-cluster">Local k8s cluster</h2>
<p>minikube quickly sets up a local Kubernetes cluster on macOS, Linux, and Windows. Easy to install and start working.</p>
<p>Install and run minikube to have a local cluster for k8s in local. If minikube is running, automatically context/namespace is updated to use then one's from minikube. If you are working with other k8s cluster, keep in mind this change. Always doble-check for namespace or context before deploying to the cluster. To work with cluster outside local, either you stop minikube or change namespace. Careful, when you stop minikube, context/namespace are set to null, so your kube commands won't be pointing to any context. You need to explicitly set again context.</p>
<p><code>minikube</code> command is just a proxy of <code>kubectl</code> commands, with a different command format but doing the same underneath.</p>
<h2 id="helm-charts">Helm charts</h2>
<p>Each object requires a custom yaml configuration file.
Helm charts provides an abstractions of the objects to deploy.
Objects are different and it is like a puzzle. It needs to fit communication/labels/namespaces...
It provides a <code>values.yaml</code> with default stuff required.
Also templates to a more complex logic.
All this parametrization is embembed in the configuration files, creating new templates.
This values can be reuse in each object.yaml file. Maximizing reusability and reducing error-prone</p>
<h2 id="readiness-and-liveness-startup-probes">Readiness and liveness, startup probes</h2>
<p>Kubernetes simply observes the pod's lifecycle and starts to route traffic to
the pod when the containers move from the Pending to Succeeded state. That
means, Kubernetes mark a pod as healthy and ready to get request as soon as this
happens. But application may receive traffic before is actually ready, because
it needs to make database connection or load some data. There is a gap between
when the app is ready and when Kubernetes thinks is ready. Risk of receive
traffic and return 500 errors. Similar case happens when Kubelet watches for
application crashes and restarts the pod to recover.</p>
<p>3 different probes:</p>
<ul>
<li>Readiness probes are used to let kubelet know when the application is ready to
  accept new traffic. It runs during the pod's entire lifecycle, to deal when
  the application is temporarily unavailable (wait for it to recover).</li>
<li>Liveness probe, determines the health, and kills the pod if it fails the
  liveness check (deadlock situation, since the underlying process continues to
  run from Kubernetes's perspective).</li>
<li>Startup probes are similar to readiness probes but only executed at startup.
  They are optimized for slow starting containers or applications with
  unpredictable initialization processes.</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://gist.github.com/McLargo/ae633d1ff481c20c21433074169d283c#file-k9s-md">k9s commands</a></li>
<li><a href="https://minikube.sigs.k8s.io/docs/handbook/">minikube handbook</a></li>
<li><a href="https://gist.github.com/McLargo/ae633d1ff481c20c21433074169d283c#file-minikube-md">minikube/kubectl commands</a></li>
<li><a href="https://blog.devgenius.io/understanding-kubernetes-probes-5daaff67599a">kubernetes probes</a></li>
<li><a href="https://srcco.de/posts/kubernetes-liveness-probes-are-dangerous.html">liveness probes tips</a></li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../serverless/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../serverless/" class="btn btn-xs btn-link">
        Serverless Computing
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../features-toggles/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../features-toggles/" class="btn btn-xs btn-link">
        Features Toggles
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content"><p>Copyright &copy; 2023 <a href="https://github.com/McLargo">Javier Gil</a>.</p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>